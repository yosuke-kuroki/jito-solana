steps:
  - command: "ci/docker-run.sh rust ci/test-stable.sh"
    name: "stable [public]"
    timeout_in_minutes: 20
  - command: "ci/shellcheck.sh"
    name: "shellcheck [public]"
    timeout_in_minutes: 20
  - wait
  - command: "ci/docker-run.sh rustlang/rust:nightly ci/test-nightly.sh"
    name: "nightly [public]"
    timeout_in_minutes: 20
  - command: "ci/test-stable-perf.sh"
    name: "stable-perf [public]"
    timeout_in_minutes: 20
    retry:
      automatic:
      - exit_status: "*"
        limit: 2
    agents:
      - "queue=cuda"
  - command: "ci/snap.sh [public]"
    timeout_in_minutes: 20
    name: "snap [public]"
  - wait
  - command: "ci/publish-crate.sh [public]"
    timeout_in_minutes: 20
    name: "publish crate"
  - command: "ci/hoover.sh [public]"
    timeout_in_minutes: 20
    name: "clean agent"

